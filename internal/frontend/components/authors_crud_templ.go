// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.865
package components

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"git.iu7.bmstu.ru/ped22u691/PPO.git/internal/models/json_req_resp"
	// "github.com/a-h/templ"
)

func AuthorsPage(tokenKey string, authors []jsonreqresp.AuthorResponse) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div class=\"crud-container\" id=\"authorsContainer\"><!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è --><div class=\"modal\" id=\"authorModal\" style=\"display: none;\"><div class=\"modal-content\" onclick=\"event.stopPropagation()\"><h3 id=\"modalTitle\">–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∞</h3><form id=\"authorForm\" onsubmit=\"return handleFormSubmit(event)\"><input type=\"hidden\" id=\"authorId\"><div class=\"form-group\"><label>–ò–º—è –∞–≤—Ç–æ—Ä–∞</label> <input type=\"text\" id=\"authorName\" required minlength=\"2\" maxlength=\"100\"></div><div class=\"form-group\"><label>–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è</label> <input type=\"number\" id=\"birthYear\" required min=\"1000\"></div><div class=\"form-group\"><label>–ì–æ–¥ —Å–º–µ—Ä—Ç–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label> <input type=\"number\" id=\"deathYear\" min=\"1000\"></div><div class=\"form-actions\"><button type=\"button\" onclick=\"closeModal()\">–û—Ç–º–µ–Ω–∞</button> <button type=\"submit\" id=\"submitButton\">–î–æ–±–∞–≤–∏—Ç—å</button></div></form></div></div><!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å --><div class=\"crud-header\"><h2>–ê–≤—Ç–æ—Ä—ã</h2><button class=\"add-button\" onclick=\"resetAndOpenModal()\">+ –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∞</button></div><!-- –¢–∞–±–ª–∏—Ü–∞ –∞–≤—Ç–æ—Ä–æ–≤ --><table class=\"crud-table\"><thead><tr><th>–ò–º—è</th><th>–ì–æ–¥—ã –∂–∏–∑–Ω–∏</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead> <tbody>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			for _, author := range authors {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "<tr><td>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				var templ_7745c5c3_Var3 string
				templ_7745c5c3_Var3, templ_7745c5c3_Err = templ.JoinStringErrs(author.Name)
				if templ_7745c5c3_Err != nil {
					return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/frontend/components/authors_crud.templ`, Line: 78, Col: 45}
				}
				_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var3))
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "</td><td>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				var templ_7745c5c3_Var4 string
				templ_7745c5c3_Var4, templ_7745c5c3_Err = templ.JoinStringErrs(author.BirthYear)
				if templ_7745c5c3_Err != nil {
					return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/frontend/components/authors_crud.templ`, Line: 80, Col: 50}
				}
				_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var4))
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, " -  ")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				if author.DeathYear != 0 {
					var templ_7745c5c3_Var5 string
					templ_7745c5c3_Var5, templ_7745c5c3_Err = templ.JoinStringErrs(author.DeathYear)
					if templ_7745c5c3_Err != nil {
						return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/frontend/components/authors_crud.templ`, Line: 82, Col: 54}
					}
					_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var5))
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
				} else {
					templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 5, "<span class=\"still-alive\">...</span>")
					if templ_7745c5c3_Err != nil {
						return templ_7745c5c3_Err
					}
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 6, "</td><td class=\"actions\">")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.JSFuncCall("prepareEditModal", author.ID, author.Name, author.BirthYear, author.DeathYear))
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 7, "<button class=\"edit-btn\" onclick=\"")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				var templ_7745c5c3_Var6 templ.ComponentScript = templ.JSFuncCall("prepareEditModal", author.ID, author.Name, author.BirthYear, author.DeathYear)
				_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var6.Call)
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 8, "\">‚úèÔ∏è</button> ")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.JSFuncCall("confirmDeleteAuthor", author.ID))
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 9, "<button class=\"delete-btn\" onclick=\"")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				var templ_7745c5c3_Var7 templ.ComponentScript = templ.JSFuncCall("confirmDeleteAuthor", author.ID)
				_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var7.Call)
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 10, "\">üóëÔ∏è</button></td></tr>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 11, "</tbody></table><!-- –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API --><script>\n                const ACCESS_TOKEN_KEY = \"@tokenKey\";\n                // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n                let isEditing = false;\n                let currentAuthor = {\n                    id: '',\n                    name: '',\n                    birthYear: 0,\n                    deathYear: 0\n                };\n\n                // –≠–ª–µ–º–µ–Ω—Ç—ã DOM\n                const modal = document.getElementById('authorModal');\n                const modalTitle = document.getElementById('modalTitle');\n                const submitButton = document.getElementById('submitButton');\n                const authorForm = document.getElementById('authorForm');\n                const authorIdInput = document.getElementById('authorId');\n                const authorNameInput = document.getElementById('authorName');\n                const birthYearInput = document.getElementById('birthYear');\n                const deathYearInput = document.getElementById('deathYear');\n\n                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞\n                function openModal() {\n                    modal.style.display = 'flex';\n                }\n\n                function closeModal() {\n                    modal.style.display = 'none';\n                }\n\n                // –ö–ª–∏–∫ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞\n                modal.addEventListener('click', function(e) {\n                    if (e.target === modal) {\n                        closeModal();\n                    }\n                });\n\n                function resetAndOpenModal() {\n                    isEditing = false;\n                    currentAuthor = { id: '', name: '', birthYear: 0, deathYear: 0 };\n                    updateFormFields();\n                    modalTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∞';\n                    submitButton.textContent = '–î–æ–±–∞–≤–∏—Ç—å';\n                    openModal();\n                }\n\n                function prepareEditModal(id, name, birthYear, deathYear) {\n                    isEditing = true;\n                    currentAuthor = {\n                        id: id,\n                        name: name,\n                        birthYear: birthYear,\n                        deathYear: deathYear || 0\n                    };\n                    updateFormFields();\n                    modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∞';\n                    submitButton.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';\n                    openModal();\n                }\n\n                function updateFormFields() {\n                    authorIdInput.value = currentAuthor.id;\n                    authorNameInput.value = currentAuthor.name;\n                    birthYearInput.value = currentAuthor.birthYear;\n                    deathYearInput.value = currentAuthor.deathYear || '';\n                }\n\n                async function handleFormSubmit(event) {\n                    event.preventDefault();\n                    \n                    const formData = {\n                        name: authorNameInput.value,\n                        birthYear: parseInt(birthYearInput.value),\n                        deathYear: deathYearInput.value ? parseInt(deathYearInput.value) : null\n                    };\n\n                    if (isEditing) {\n                        formData.id = authorIdInput.value;\n                        await updateAuthor(formData);\n                    } else {\n                        await addAuthor(formData);\n                    }\n                }\n\n                async function confirmDeleteAuthor(id) {\n                    if (!confirm('–£–¥–∞–ª–∏—Ç—å –∞–≤—Ç–æ—Ä–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;\n                    await deleteAuthor(id);\n                }\n\n                // API —Ñ—É–Ω–∫—Ü–∏–∏\n                async function fetchAuthors() {\n                    try {\n                        const response = await fetch('/api/v1/employee/authors', {\n                            headers: {\n                                'Authorization': `Bearer ${localStorage.getItem(ACCESS_TOKEN_KEY)}`\n                            }\n                        });\n                        return await response.json();\n                    } catch (error) {\n                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤—Ç–æ—Ä–æ–≤:', error);\n                        return [];\n                    }\n                }\n\n                async function addAuthor(data) {\n                    try {\n                        const response = await fetch('/api/v1/employee/authors', {\n                            method: 'POST',\n                            headers: {\n                                'Content-Type': 'application/json',\n                                'Authorization': `Bearer ${localStorage.getItem(ACCESS_TOKEN_KEY)}`\n                            },\n                            body: JSON.stringify(data)\n                        });\n\n                        if (!response.ok) throw await response.json();\n                        window.location.reload();\n                    } catch (error) {\n                        console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', error);\n                        alert(error.error || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∞');\n                    }\n                }\n\n                async function updateAuthor(data) {\n                    try {\n                        const response = await fetch('/api/v1/employee/authors', {\n                            method: 'PUT',\n                            headers: {\n                                'Content-Type': 'application/json',\n                                'Authorization': `Bearer ${localStorage.getItem(ACCESS_TOKEN_KEY)}`\n                            },\n                            body: JSON.stringify(data)\n                        });\n\n                        if (!response.ok) throw await response.json();\n                        window.location.reload();\n                    } catch (error) {\n                        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', error);\n                        alert(error.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∞');\n                    }\n                }\n\n                async function deleteAuthor(id) {\n                    try {\n                        const response = await fetch('/api/v1/employee/authors', {\n                            method: 'DELETE',\n                            headers: {\n                                'Content-Type': 'application/json',\n                                'Authorization': `Bearer ${localStorage.getItem(ACCESS_TOKEN_KEY)}`\n                            },\n                            body: JSON.stringify({ id })\n                        });\n \n                        if (!response.ok) throw await response.json();\n                        window.location.reload();\n                    } catch (error) {\n                        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);\n                        alert(error.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∞–≤—Ç–æ—Ä–∞');\n                    }\n                }\n\n                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ\n                document.addEventListener('DOMContentLoaded', function() {\n                    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≥–æ–¥–∞ —Å–º–µ—Ä—Ç–∏ —Ä–∞–≤–Ω—ã–º –≥–æ–¥—É —Ä–æ–∂–¥–µ–Ω–∏—è\n                    birthYearInput.addEventListener('change', function() {\n                        deathYearInput.min = this.value;\n                    });\n                });\n            </script></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = EmployeesNavigate("–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∞–º–∏").Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
